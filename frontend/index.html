<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/verisafe-logo.svg" />
    <link rel="apple-touch-icon" href="/verisafe-logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VeriSafe - Privacy-Preserving Age Verification</title>
  </head>
  <body>
    <div id="root"></div>
    <!-- Polyfill for CommonJS globals (module, exports, require) - must be before any other scripts -->
    <script>
      // Define module polyfill for CommonJS compatibility (needed by relayer-sdk)
      var moduleObj = { exports: {} };
      if (typeof module === 'undefined') {
        window.module = moduleObj;
      }
      if (typeof globalThis !== 'undefined' && typeof globalThis.module === 'undefined') {
        globalThis.module = moduleObj;
      }
      
      // Define exports - in CommonJS, exports is a reference to module.exports
      if (typeof exports === 'undefined') {
        // exports should point to module.exports
        try {
          window.exports = moduleObj.exports;
        } catch (e) {
          window.exports = {};
        }
      }
      if (typeof globalThis !== 'undefined' && typeof globalThis.exports === 'undefined') {
        try {
          globalThis.exports = moduleObj.exports;
        } catch (e) {
          globalThis.exports = {};
        }
      }
      
      // Define require polyfill for CommonJS compatibility (needed by relayer-sdk)
      // Create a base class that can be extended (for stream modules and any Node.js modules)
      function BaseNodeModule() {}
      BaseNodeModule.prototype = {};
      
      // Make it look like a proper class that can be extended
      Object.setPrototypeOf(BaseNodeModule, Function.prototype);
      
      // Create a universal require function that always returns a valid constructor
      function createRequirePolyfill() {
        return function(id) {
          // Normalize the module ID (remove .js extension, handle relative paths)
          var normalizedId = String(id || '').replace(/\.js$/, '');
          
          // Check if this looks like a stream-related module
          var isStreamModule = normalizedId.includes('stream') || 
                               normalizedId.includes('_stream') || 
                               normalizedId.includes('/streams/') ||
                               normalizedId === 'stream';
          
          // For all modules, return a constructor that can be extended
          if (isStreamModule) {
            console.warn('require() called for stream module:', id, '- Using BaseNodeModule constructor');
          } else {
            console.warn('require() called for:', id, '- Using BaseNodeModule constructor as fallback');
          }
          
          // Always return the constructor - never undefined or null
          return BaseNodeModule;
        };
      }
      
      // Set up require on window and globalThis
      if (typeof require === 'undefined') {
        window.require = createRequirePolyfill();
        // Also set up require.cache for compatibility
        window.require.cache = {};
      }
      if (typeof globalThis !== 'undefined' && typeof globalThis.require === 'undefined') {
        globalThis.require = createRequirePolyfill();
        globalThis.require.cache = {};
      }
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
